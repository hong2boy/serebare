(function($) {
  $(function() {
    window.onunload = function() {
      window.scrollTo(0, 0)
    };
    pd_Default_info();
    pd_Default_Contents();

    function pd_Default_info() {
      var pd_info = $('.infoArea');
      if (pd_Share == "off") {
        pd_info.find('.share-wrap').addClass('offDisplay')
      } else {
        pd_info.find('.share-wrap').removeClass('offDisplay on_off_select')
      }
      if (pd_PlusDiscount == "off") {
        pd_info.find(".benefit-slide").addClass('offHeight')
      } else {
        pd_info.find(".benefit-slide").removeClass('offHeight on_off_select')
      }
      if (pd_Card_FreeInstallment == "off") {
        pd_info.find('.card-benefit').addClass('offDisplay')
      } else {
        pd_info.find('.card-benefit').removeClass('offDisplay on_off_select')
      }
    }

    function pd_Default_Contents() {
      if (pd_MemberShip == "off") {
        $('.member-benefit').addClass('offDisplay')
      }
      if (pd_Review_Banner == "off") {
        $('#prdReview').find('.detail-banner img').addClass('offDisplay')
      }
    }
    var prdScope = $(".xans-product-detaildesign").find('th[scope="row"]');
    prdScope.each(function() {
      var prdScopeText = $(this).find('span').html();
      if (prdScopeText == "비디오" || prdScopeText == "상품간략설명") {
        $(this).parent("tr").hide()
      }
    });
    var cImg = $(".cont").find('img');
    var mainSlideLength = $('.listImg ul li').length;
    $(window).on("load", function() {
      cImg.each(function(index, el) {
        var cImgGetState = $(this).attr("ec-data-src");
        $(this).attr("src", cImgGetState)
      });
    });

    $(".listImg ul>li").eq(0).remove();

    $(".u_bigImg").addClass('xans-record-');
    $(".u_bigImg>img").addClass('ThumbImage');

    $(".u_bigImg").prependTo("#prd_uSlideWrap");
    $(".listImg ul").clone().appendTo(".keyImg");

    if (mainSlideLength > 1) {
      $('.KeyImg__Control__Container').show();
      var keyImgSlider = $(".keyImg ul").bxSlider({
        nextSelector: ".KeyImg__Control__Arrow__Right",
        prevSelector: ".KeyImg__Control__Arrow__Left",
        pager: false,
        onSliderLoad: function(currentIndex) {
          var thumbImg = $(".listImg .ThumbImage").eq(currentIndex);
          thumbImg.addClass('onImg')
        },
        onSlideBefore: function($slideElement, oldIndex, newIndex) {
          var thumbImg = $(".listImg .ThumbImage").eq(newIndex);
          $(".listImg .ThumbImage").removeClass('onImg');
          thumbImg.addClass('onImg')
        },
        onSlideAfter: function($slideElement, oldIndex, newIndex) {}
      });
      $(".listImg .ThumbImage").click(function(event) {
        var selectIndex = $(this).index(".listImg .ThumbImage");
        keyImgSlider.goToSlide(selectIndex)
      });
      $(".u_bigImg").addClass('on');
    } else {
      $('.KeyImg__Control__Container').hide();
      var keyImgSlider = $(".keyImg ul").bxSlider({
        infiniteLoop: false,
        controls: false,
        pager: false
      });
      $(".u_bigImg").addClass('on');
    }
    $(".card-btn").click(function(event) {
      $(".card-benefit-box").fadeIn('400', function() {
        var popupShip = true;
        $('body').click(function(e) {
          if ($(e.target).closest('.card-benefit-box').length == 0 && popupShip == true || $(e.target).is('.ti-close')) {
            $(".card-benefit-box").fadeOut('400', function() {
              popupShip = false
            })
          }
        })
      })
    });
    var detailContentsOffset = $('#prdDetail').offset().top;
    var rightPopTriggerOffset = Math.ceil(detailContentsOffset) + 100;
    var gridTop = new Array();
    var gridBottom = new Array();
    var option = false;
    var grid5GetOffset = false;
    var rFixOn = false;
    var scrollPositionTop = $(window).scrollTop();
    var scrollPositionBottom = $(window).height() + $(window).scrollTop();
    var scrollPositionMiddle = $(window).height() / 2 + $(window).scrollTop();

    function rFixPath() {
      var contImg = $('.cont').find('img').attr('ec-data-src');
      scrollPositionTop = $(window).scrollTop();
      scrollPositionBottom = $(window).height() + scrollPositionTop;
      scrollPositionMiddle = $(window).height() / 2 + scrollPositionTop;
      var getDeatilAreaHeight = $(".detailArea ").height();
      if (grid5GetOffset == false && contImg == undefined) {
        $(".grid5").each(function(i) {
          gridTop[i] = $(this).offset().top;
          gridBottom[i] = $(this).offset().top + $(this).height()
        });
      }
      if (scrollPositionTop - 100 > getDeatilAreaHeight && rFixOn == false) {
        $(".detailArea").height(getDeatilAreaHeight);
        $('.r-buy-wrap , .r-fix-path').addClass('active');
        $(".infoArea").appendTo('.r-option-box');
        rFixOn = true
      } else if (scrollPositionTop - 100 < getDeatilAreaHeight && rFixOn == true) {
        $(".detailArea").css('height', 'auto');
        $('.r-buy-wrap , .r-fix-path').removeClass('active on');
        $(".infoArea").appendTo('.detailArea');
        rFixOn = false
      }
      for (var z = 0; z < gridTop.length; z++) {
        if (scrollPositionMiddle > gridTop[z] && gridTop[z + 1] > scrollPositionMiddle) {
          $('.r-fix-path ul li').not(z).removeClass('on');
          $('.r-fix-path ul li').eq(z).addClass('on');
          break
        } else if (scrollPositionMiddle > gridTop[0] && z == gridTop.length - 1) {
          $('.r-fix-path ul li').not(z).removeClass('on');
          $('.r-fix-path ul li').eq(z).addClass('on');
          break
        }
      }
    };
    window.addEventListener('scroll', throttle(rFixPath, 5));

    function throttle(callback, limit) {
      var wait = false;
      return function() {
        if (!wait) {
          callback.apply(null, arguments);
          wait = true;
          setTimeout(function() {
            wait = false
          }, limit)
        }
      }
    }
    var maxGrid5Length = $(".grid5").length - 1;
    $(".r-buy-btn").click(function() {
      $(".r-buy-wrap").toggleClass('on')
    });
    $(".menu li").click(function(e) {
      var prdTargetEq = $(this).index();
      e.preventDefault();
      $('.r-fix-path ul li').eq(prdTargetEq).trigger('click')
    });
    $('.r-fix-path ul li').click(function(e) {
      var prdTargetEq = $(this).index();
      e.preventDefault();
      $('html, body').animate({
        scrollTop: $('.grid5').eq(prdTargetEq).offset().top - 120
      }, 500)
    });
    $(".share-btn").click(function(event) {
      $(".share-pop").fadeIn('400', function() {
        var thisUrl = location.href;
        var getText = $(".share-pop").find('input');
        getText.attr('value', thisUrl);
        $(".text-form button").click(function(event) {
          getText.select();
          document.execCommand("copy")
        });
        var popupShip = true;
        $('body').click(function(e) {
          if ($(e.target).closest('.share-pop').length == 0 && popupShip == true || $(e.target).is('.ti-close')) {
            $(".share-pop").fadeOut('400', function() {
              popupShip = false
            })
          }
        })
      })
    })
  })
})(jQuery);
